========================================
PROPERTY SEARCH API - ANGULAR FRONTEND GUIDE
========================================

## 1. MAIN SEARCH ENDPOINT (RECOMMENDED)

**Endpoint:** GET /property
**Description:** Dynamic search với multiple filters (tất cả parameters là optional)

### Available Query Parameters:
- type: Integer (1=HOUSE, 2=APARTMENT, 3=VILLA, 4=HOTEL)
- city: String (tên thành phố, vd: "HaNoi")
- location: String (tên location, vd: "BaDinh")
- minPrice: Number (giá tối thiểu)
- maxPrice: Number (giá tối đa)
- bedrooms: Integer (số phòng ngủ)
- bathrooms: Integer (số phòng tắm)
- maxAdults: Integer (số người lớn tối đa)
- maxChildren: Integer (số trẻ em tối đa)
- maxInfants: Integer (số em bé tối đa)
- maxPets: Integer (số thú cưng tối đa)
- amenities: Array<Integer> (danh sách ID tiện nghi, vd: 1,2,3)
- facilities: Array<Integer> (danh sách ID cơ sở, vd: 1,2,3)

### Example URLs:

1. Tất cả properties available:
   GET http://localhost:8080/property

2. Tìm theo city:
   GET http://localhost:8080/property?city=HaNoi

3. Tìm theo type và city:
   GET http://localhost:8080/property?type=1&city=HaNoi

4. Tìm theo nhiều filters:
   GET http://localhost:8080/property?type=1&city=HaNoi&minPrice=100&maxPrice=500&bedrooms=2&bathrooms=1

5. Tìm theo amenities:
   GET http://localhost:8080/property?amenities=1,2,3

6. Tìm theo tất cả filters:
   GET http://localhost:8080/property?type=1&city=HaNoi&location=BaDinh&minPrice=100&maxPrice=1000&bedrooms=2&bathrooms=2&maxAdults=4&maxChildren=2&amenities=1,2,3&facilities=4,5,6

========================================
## 2. ANGULAR SERVICE IMPLEMENTATION
========================================

### Create PropertyService (property.service.ts)

```typescript
import { Injectable } from '@angular/core';
import { HttpClient, HttpParams } from '@angular/common/http';
import { Observable } from 'rxjs';

export interface PropertySearchParams {
  type?: number;
  city?: string;
  location?: string;
  minPrice?: number;
  maxPrice?: number;
  bedrooms?: number;
  bathrooms?: number;
  maxAdults?: number;
  maxChildren?: number;
  maxInfants?: number;
  maxPets?: number;
  amenities?: number[];
  facilities?: number[];
}

export interface BaseResponse<T> {
  code: number;
  message: string;
  data: T;
}

@Injectable({
  providedIn: 'root'
})
export class PropertyService {
  private apiUrl = 'http://localhost:8080/property';

  constructor(private http: HttpClient) {}

  /**
   * Dynamic search với multiple filters
   */
  searchProperties(filters: PropertySearchParams): Observable<BaseResponse<any[]>> {
    let params = new HttpParams();

    // Chỉ thêm params nếu có giá trị
    if (filters.type !== undefined && filters.type !== null) {
      params = params.set('type', filters.type.toString());
    }
    if (filters.city) {
      params = params.set('city', filters.city);
    }
    if (filters.location) {
      params = params.set('location', filters.location);
    }
    if (filters.minPrice !== undefined && filters.minPrice !== null) {
      params = params.set('minPrice', filters.minPrice.toString());
    }
    if (filters.maxPrice !== undefined && filters.maxPrice !== null) {
      params = params.set('maxPrice', filters.maxPrice.toString());
    }
    if (filters.bedrooms !== undefined && filters.bedrooms !== null) {
      params = params.set('bedrooms', filters.bedrooms.toString());
    }
    if (filters.bathrooms !== undefined && filters.bathrooms !== null) {
      params = params.set('bathrooms', filters.bathrooms.toString());
    }
    if (filters.maxAdults !== undefined && filters.maxAdults !== null) {
      params = params.set('maxAdults', filters.maxAdults.toString());
    }
    if (filters.maxChildren !== undefined && filters.maxChildren !== null) {
      params = params.set('maxChildren', filters.maxChildren.toString());
    }
    if (filters.maxInfants !== undefined && filters.maxInfants !== null) {
      params = params.set('maxInfants', filters.maxInfants.toString());
    }
    if (filters.maxPets !== undefined && filters.maxPets !== null) {
      params = params.set('maxPets', filters.maxPets.toString());
    }
    if (filters.amenities && filters.amenities.length > 0) {
      params = params.set('amenities', filters.amenities.join(','));
    }
    if (filters.facilities && filters.facilities.length > 0) {
      params = params.set('facilities', filters.facilities.join(','));
    }

    return this.http.get<BaseResponse<any[]>>(this.apiUrl, { params });
  }

  /**
   * Get property by ID
   */
  getPropertyById(id: number): Observable<BaseResponse<any>> {
    return this.http.get<BaseResponse<any>>(`${this.apiUrl}/${id}`);
  }

  /**
   * Get all properties (không filter)
   */
  getAllProperties(): Observable<BaseResponse<any[]>> {
    return this.http.get<BaseResponse<any[]>>(`${this.apiUrl}/all`);
  }

  /**
   * Get top 5 properties
   */
  getTop5Properties(): Observable<BaseResponse<any[]>> {
    return this.http.get<BaseResponse<any[]>>(`${this.apiUrl}/top5`);
  }
}
```

========================================
## 3. ANGULAR COMPONENT IMPLEMENTATION
========================================

### Create SearchComponent (property-search.component.ts)

```typescript
import { Component, OnInit } from '@angular/core';
import { PropertyService, PropertySearchParams } from './property.service';

@Component({
  selector: 'app-property-search',
  templateUrl: './property-search.component.html',
  styleUrls: ['./property-search.component.css']
})
export class PropertySearchComponent implements OnInit {
  properties: any[] = [];
  loading = false;
  error: string | null = null;

  // Filter model
  filters: PropertySearchParams = {};

  // Options for dropdowns
  propertyTypes = [
    { value: 1, label: 'House' },
    { value: 2, label: 'Apartment' },
    { value: 3, label: 'Villa' },
    { value: 4, label: 'Hotel' }
  ];

  constructor(private propertyService: PropertyService) {}

  ngOnInit(): void {
    // Load all properties khi init
    this.searchProperties();
  }

  /**
   * Tìm kiếm properties với filters hiện tại
   */
  searchProperties(): void {
    this.loading = true;
    this.error = null;

    this.propertyService.searchProperties(this.filters).subscribe({
      next: (response) => {
        if (response.code === 200) {
          this.properties = response.data;
        }
        this.loading = false;
      },
      error: (err) => {
        this.error = err.error?.message || 'Failed to load properties';
        this.loading = false;
        console.error('Search error:', err);
      }
    });
  }

  /**
   * Reset tất cả filters
   */
  resetFilters(): void {
    this.filters = {};
    this.searchProperties();
  }

  /**
   * Xử lý khi thay đổi filter
   */
  onFilterChange(): void {
    // Tự động search khi filter thay đổi
    this.searchProperties();
  }
}
```

========================================
## 4. ANGULAR TEMPLATE EXAMPLE
========================================

### property-search.component.html

```html
<div class="search-container">
  <h2>Search Properties</h2>

  <!-- Filter Form -->
  <div class="filters">
    <div class="filter-row">
      <!-- Property Type -->
      <div class="filter-field">
        <label>Property Type</label>
        <select [(ngModel)]="filters.type" (change)="onFilterChange()">
          <option [ngValue]="undefined">All Types</option>
          <option *ngFor="let type of propertyTypes" [value]="type.value">
            {{ type.label }}
          </option>
        </select>
      </div>

      <!-- City -->
      <div class="filter-field">
        <label>City</label>
        <input type="text"
               [(ngModel)]="filters.city"
               (input)="onFilterChange()"
               placeholder="e.g., HaNoi">
      </div>

      <!-- Location -->
      <div class="filter-field">
        <label>Location</label>
        <input type="text"
               [(ngModel)]="filters.location"
               (input)="onFilterChange()"
               placeholder="e.g., BaDinh">
      </div>
    </div>

    <div class="filter-row">
      <!-- Price Range -->
      <div class="filter-field">
        <label>Min Price</label>
        <input type="number"
               [(ngModel)]="filters.minPrice"
               (input)="onFilterChange()"
               placeholder="Min">
      </div>

      <div class="filter-field">
        <label>Max Price</label>
        <input type="number"
               [(ngModel)]="filters.maxPrice"
               (input)="onFilterChange()"
               placeholder="Max">
      </div>

      <!-- Bedrooms -->
      <div class="filter-field">
        <label>Bedrooms</label>
        <input type="number"
               [(ngModel)]="filters.bedrooms"
               (input)="onFilterChange()"
               placeholder="Number">
      </div>

      <!-- Bathrooms -->
      <div class="filter-field">
        <label>Bathrooms</label>
        <input type="number"
               [(ngModel)]="filters.bathrooms"
               (input)="onFilterChange()"
               placeholder="Number">
      </div>
    </div>

    <div class="filter-row">
      <!-- Guests -->
      <div class="filter-field">
        <label>Adults</label>
        <input type="number"
               [(ngModel)]="filters.maxAdults"
               (input)="onFilterChange()"
               placeholder="Max Adults">
      </div>

      <div class="filter-field">
        <label>Children</label>
        <input type="number"
               [(ngModel)]="filters.maxChildren"
               (input)="onFilterChange()"
               placeholder="Max Children">
      </div>

      <div class="filter-field">
        <label>Pets</label>
        <input type="number"
               [(ngModel)]="filters.maxPets"
               (input)="onFilterChange()"
               placeholder="Max Pets">
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="filter-actions">
      <button (click)="searchProperties()" class="btn-search">
        Search
      </button>
      <button (click)="resetFilters()" class="btn-reset">
        Reset Filters
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading">
    <p>Loading properties...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error">
    <p>{{ error }}</p>
  </div>

  <!-- Results -->
  <div *ngIf="!loading && !error" class="results">
    <h3>Found {{ properties.length }} properties</h3>

    <div class="property-grid">
      <div *ngFor="let property of properties" class="property-card">
        <h4>{{ property.propertyName }}</h4>
        <p>{{ property.fullAddress }}</p>
        <p>Price: {{ property.pricePerNight | currency }}</p>
        <p>Bedrooms: {{ property.numberOfBedrooms }}</p>
        <p>Bathrooms: {{ property.numberOfBathrooms }}</p>
        <button (click)="viewDetails(property.id)">View Details</button>
      </div>
    </div>

    <div *ngIf="properties.length === 0" class="no-results">
      <p>No properties found matching your criteria.</p>
    </div>
  </div>
</div>
```

========================================
## 5. USAGE EXAMPLES
========================================

### Example 1: Simple search by city
```typescript
this.propertyService.searchProperties({ city: 'HaNoi' }).subscribe(response => {
  console.log(response.data);
});
```

### Example 2: Search with multiple filters
```typescript
const filters: PropertySearchParams = {
  type: 1,
  city: 'HaNoi',
  minPrice: 100,
  maxPrice: 500,
  bedrooms: 2,
  maxAdults: 4
};

this.propertyService.searchProperties(filters).subscribe(response => {
  this.properties = response.data;
});
```

### Example 3: Search with amenities
```typescript
const filters: PropertySearchParams = {
  city: 'HaNoi',
  amenities: [1, 2, 3], // WiFi, Pool, Parking
  facilities: [4, 5]     // Gym, Restaurant
};

this.propertyService.searchProperties(filters).subscribe(response => {
  this.properties = response.data;
});
```

========================================
## 6. IMPORTANT NOTES
========================================

1. **All filters are optional** - Nếu không truyền filter nào, sẽ trả về tất cả properties AVAILABLE

2. **Status filtering** - Backend tự động filter chỉ lấy properties có status = "AVAILABLE"

3. **Array parameters** - Amenities và facilities phải được join thành string với dấu phẩy (vd: "1,2,3")

4. **Error handling** - Backend sẽ throw DataNotFoundException nếu không tìm thấy properties

5. **Performance** - Sử dụng JPA Specification để tối ưu query, chỉ filter theo những params được truyền

6. **Backward compatibility** - Các endpoints cũ vẫn hoạt động:
   - GET /property/all - Lấy tất cả properties
   - GET /property/{id} - Lấy property theo ID
   - GET /property/city/{cityName} - Lấy theo city
   - etc.

========================================
## 7. TESTING WITH POSTMAN/CURL
========================================

### Test 1: Get all properties
```
GET http://localhost:8080/property
```

### Test 2: Search by city
```
GET http://localhost:8080/property?city=HaNoi
```

### Test 3: Complex search
```
GET http://localhost:8080/property?type=1&city=HaNoi&minPrice=100&maxPrice=500&bedrooms=2&bathrooms=1&maxAdults=4&amenities=1,2,3
```

========================================
Generated on: October 15, 2025
Backend Port: 8080
========================================

