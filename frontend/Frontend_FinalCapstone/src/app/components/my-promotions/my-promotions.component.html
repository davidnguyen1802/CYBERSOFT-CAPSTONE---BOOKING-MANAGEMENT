<div class="user-promotions-container">
  <div class="container py-5">
    <!-- Header -->
    <div class="page-header mb-4">
      <h1 class="page-title">
        <i class="fas fa-ticket-alt me-2"></i>
        Mã Giảm Giá Của Bạn
      </h1>
      <p class="text-muted">Quản lý và sử dụng các mã giảm giá của bạn</p>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Đang tải...</span>
      </div>
      <p class="mt-3 text-muted">Đang tải mã giảm giá...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="alert alert-danger" role="alert">
      <i class="fas fa-exclamation-triangle me-2"></i>
      {{ error }}
    </div>

    <!-- Content -->
    <div *ngIf="!loading && !error">
      
      <!-- Active Promotions -->
      <div class="promotion-section mb-5" *ngIf="activePromotions.length > 0">
        <h2 class="section-title">
          <i class="fas fa-star text-warning me-2"></i>
          Mã Khả Dụng ({{ activePromotions.length }})
        </h2>
        <div class="row g-4">
          <div class="col-md-6 col-lg-4" *ngFor="let promo of activePromotions">
            <div class="promotion-card active-card">
              <div class="card-badge badge-active">Khả dụng</div>
              <div class="card-badge badge-expiring" *ngIf="promo.expiresDate && isExpiringSoon(promo.expiresDate)">
                Sắp hết hạn!
              </div>
              
              <div class="promotion-header">
                <div class="promotion-icon">
                  <i class="fas fa-gift"></i>
                </div>
                <div class="promotion-name">{{ promo.promotionName }}</div>
              </div>

              <div class="promotion-body">
                <div class="promotion-code-container">
                  <span class="code-label">Mã giảm giá:</span>
                  <div class="code-display">
                    <span class="code-text">{{ promo.promotionCode }}</span>
                    <button 
                      class="btn btn-sm btn-copy" 
                      (click)="copyPromotionCode(promo.promotionCode)"
                      title="Sao chép mã">
                      <i class="fas fa-copy"></i>
                    </button>
                  </div>
                </div>

                <div class="promotion-dates">
                  <div class="date-item">
                    <i class="fas fa-calendar-plus me-1"></i>
                    <small>Được cấp: {{ formatDate(promo.assignedDate) }}</small>
                  </div>
                  <div class="date-item" *ngIf="promo.expiresDate">
                    <i class="fas fa-calendar-times me-1"></i>
                    <small>Hết hạn: {{ formatDate(promo.expiresDate) }}</small>
                  </div>
                </div>
              </div>

              <div class="promotion-footer">
                <button class="btn btn-primary btn-sm w-100">
                  <i class="fas fa-shopping-cart me-1"></i>
                  Dùng Ngay
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Used Promotions -->
      <div class="promotion-section mb-5" *ngIf="usedPromotions.length > 0">
        <h2 class="section-title">
          <i class="fas fa-check-circle text-success me-2"></i>
          Đã Sử Dụng ({{ usedPromotions.length }})
        </h2>
        <div class="row g-4">
          <div class="col-md-6 col-lg-4" *ngFor="let promo of usedPromotions">
            <div class="promotion-card used-card">
              <div class="card-badge badge-used">Đã dùng</div>
              
              <div class="promotion-header">
                <div class="promotion-icon">
                  <i class="fas fa-check"></i>
                </div>
                <div class="promotion-name">{{ promo.promotionName }}</div>
              </div>

              <div class="promotion-body">
                <div class="promotion-code-container">
                  <span class="code-label">Mã:</span>
                  <div class="code-display disabled">
                    <span class="code-text">{{ promo.promotionCode }}</span>
                  </div>
                </div>

                <!-- Usage Details -->
                <div class="usage-details">
                  <div class="usage-item" *ngIf="promo.promotionUsages && promo.promotionUsages.length > 0">
                    <i class="fas fa-calendar-check me-1"></i>
                    <small>Đã dùng: {{ formatDate(promo.promotionUsages[0].usedDate) }}</small>
                  </div>
                  <div class="usage-item" *ngIf="promo.promotionUsages && promo.promotionUsages.length > 0">
                    <i class="fas fa-receipt me-1"></i>
                    <small>Booking #{{ promo.promotionUsages[0].idBooking }}</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Expired Promotions -->
      <div class="promotion-section mb-5" *ngIf="expiredPromotions.length > 0">
        <h2 class="section-title">
          <i class="fas fa-clock text-secondary me-2"></i>
          Đã Hết Hạn ({{ expiredPromotions.length }})
        </h2>
        <div class="row g-4">
          <div class="col-md-6 col-lg-4" *ngFor="let promo of expiredPromotions">
            <div class="promotion-card expired-card">
              <div class="card-badge badge-expired">Hết hạn</div>
              
              <div class="promotion-header">
                <div class="promotion-icon">
                  <i class="fas fa-times"></i>
                </div>
                <div class="promotion-name">{{ promo.promotionName }}</div>
              </div>

              <div class="promotion-body">
                <div class="promotion-code-container">
                  <span class="code-label">Mã:</span>
                  <div class="code-display disabled">
                    <span class="code-text">{{ promo.promotionCode }}</span>
                  </div>
                </div>

                <div class="promotion-dates" *ngIf="promo.expiresDate">
                  <div class="date-item">
                    <i class="fas fa-calendar-times me-1"></i>
                    <small>Hết hạn: {{ formatDate(promo.expiresDate) }}</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="promotions.length === 0" class="empty-state text-center py-5">
        <i class="fas fa-ticket-alt fa-5x text-muted mb-3"></i>
        <h3>Chưa Có Mã Giảm Giá</h3>
        <p class="text-muted">Bạn chưa có mã giảm giá nào. Hãy tham gia các chương trình khuyến mãi để nhận mã!</p>
        <a routerLink="/" class="btn btn-primary mt-3">
          <i class="fas fa-home me-2"></i>
          Về Trang Chủ
        </a>
      </div>

      <!-- Pagination -->
      <app-pagination
        *ngIf="!loading && totalPages > 1"
        [currentPage]="currentPage"
        [totalPages]="totalPages"
        [totalElements]="totalElements"
        [pageSize]="pageSize"
        [isFirst]="currentPage === 0"
        [isLast]="currentPage === totalPages - 1"
        (pageChange)="onPageChange($event)">
      </app-pagination>

    </div>
  </div>
</div>
